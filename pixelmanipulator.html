<!doctype html>
<!--
	This is the test html file intended to show what this library can do.
    Copyright (C) 2018  Nathan Fritzler

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
	<head>
		<!--Declarations and types (media objs and favicons)-->
		<title>Pixel Manipulator</title>
		<meta charset="utf-8">
		<!--CSS files-->
		<style>
		body{
			background-color:grey;
		}
		#canvas{/*This is where the pixels are being renderd*/
			position:fixed;
			top:0;
			left:0;
		}
		#zoom-box{/*This is the container for the zoomed-in box that the user can interact with*/
			position:fixed;
			top:0;
			right:0;
			z-index:999;
			height:100%
			overflow: scroll;
		}
		</style>
	</head>
	<body>
		<!--Content-->
		<canvas id="canvas"></canvas><!--This is the place where the pixels are rendered-->
		<div id="zoom-box"><!--This is the container for the zoomed-in box that the user can interact with-->
			<canvas id="zoom" width="400" height="400"></canvas><br/><!--This is the zoomed-in box that the user can interact with-->
			<input id="file" type="file" /><!--This is where the user can upload an image that will then applied to the canvas,and will allow for coming back from saving-->
			<button id="play" alt="Play/Resume/Rewind" title="Play/Resume">►</button><!--The play button that changes into a restart button when pressed,unless it's paused,then it's a play button again.-->
			<button id="pause" alt="Pause" title="Pause">▌▌</button><!--This pauses everything in #canvas-->
			<button id="oneFrameAtATime" onclick="loop();" alt="Next frame" title="Next frame">►▌</button><!--This executes the function called by setInterval in the play button once per click,iterating one frame at a time-->
			<!--button id="record" alt="Toggle Recording" title="Toggle Recording">•</button><!--This records #canvas as a .gif file and once clicked a second time,allows for the user to download the .gif. (it also resets the .gif if clicked again,and starts recoring again)-->
			<br/>
			Width: <input id="width"/><br/>
			Height: <input id="height" /><br/>
			Zoom Width: <input id="zoomWidthElm"/><br/>
			Zoom Height: <input id="zoomHeightElm"/><br/>
			<br/>
			Normal click: 
			<select class="elmDrop" onchange="normalClickChange(this)">
				<option>Acid</option>
				<option>Blocks</option>
				<option>Conductor</option>
				<option selected="selected">Conway's Game Of Life</option>
				<option>Electricity</option>
				<option>FadingElectricity</option>
				<option>Highlife</option>
				<option>No-loop Conway's Game Of Life</option>
				<option>Rule 30</option>
				<option>Rule 90</option>
				<option>Rule 110</option>
				<option>Rule 184</option>
				<option>Water</option>
			</select>
			<br/>
			Ctrl click: 
			<select class="elmDrop" onchange="ctrlClickChange(this)">
				<option>Acid</option>
				<option selected="selected">Blocks</option>
				<option>Conductor</option>
				<option>Conway's Game Of Life</option>
				<option>Electricity</option>
				<option>FadingElectricity</option>
				<option>Highlife</option>
				<option>No-loop Conway's Game Of Life</option>
				<option>Rule 30</option>
				<option>Rule 90</option>
				<option>Rule 110</option>
				<option>Rule 184</option>
				<option>Water</option>
			</select><br/>
			Alt click: 
			<select class="elmDrop" onchange="altClickChange(this)">
				<option>Acid</option>
				<option>Blocks</option>
				<option>Conductor</option>
				<option>Conway's Game Of Life</option>
				<option>Electricity</option>
				<option>FadingElectricity</option>
				<option>Highlife</option>
				<option>No-loop Conway's Game Of Life</option>
				<option>Rule 30</option>
				<option>Rule 90</option>
				<option>Rule 110</option>
				<option>Rule 184</option>
				<option selected="selected">Water</option>
			</select><br/>
			<span style="position:absolute; right:0px; bottom:0px">v1-beta.47.110</span><!-- -->
		</div>
		<script src="pixelmanipulator.js"></script>
		<script>
			window.onready=function() {
				var file = document.getElementById('file'),
					normalClick="Conway's Game Of Life",
					ctrlClick="Blocks",
					altClick="Water",
					canvas = p.canvas = document.getElementById('canvas'),
					zoomelm = p.zoomelm = document.getElementById('zoom');
				console.log(zoomelm);
				p.elementTypeMap={
					"Acid":[110,162,10,255],
					"Blocks":[127,127,127,255],
					"Conductor":[67,75,77,255],
					"Conway's Game Of Life":[0,255,0,255],
					"Electricity":[148,133,0,255],
					"FadingElectricity":[148,133,0,254],
					"Highlife":[0,255,128],
					"No-loop Conway's Game Of Life":[0,150,0,255],
					"Rule 30":[255,0,255,255],
					"Rule 90":[147,112,219,255],
					"Rule 110":[128,0,128,255],
					"Rule 184":[255,51,153,255],
					"Water":[23,103,167,255],
					"blank":[0,0,0,255]
				};
				function setCanvasSizes() {
					canvas.width=document.getElementById("width").value||100;
					canvas.height=document.getElementById("height").value||100;
					zoomelm.width=(document.getElementById("zoomWidthElm").value||20)*20;
					zoomelm.height=(document.getElementById("zoomHeightElm").value||20)*20;
					p.updateCanvasData();
				}
				file.addEventListener('change',function(e) {
					var img = new Image;
					img.src = URL.createObjectURL(e.target.files[0]);
					img.onload = function() {
						this.style.display = 'none';
						setCanvasSizes();
						p.ctx.drawImage(this,0,0);
						document.getElementById('pause').disabled=true;
					}
				});
				document.getElementById("play").addEventListener('click',function() {
					if (!document.getElementById('pause').disabled) {
						clearInterval(loopint);
						setCanvasSizes();
						for (var i=0; i < data.length; i+=4) {
							for (var ii=0; ii <=2; ii++) data[i+ii]=0;
							data[i+3]=255;
						}
						p.ctx.putImageData(p.imageData,0,0);
					}
					document.getElementById('pause').disabled = false;
					document.getElementById('play').innerHTML = "◄";
					p.loopint=setInterval(p.loop,1);
				});
				document.getElementById("pause").addEventListener('click',function() {
					document.getElementById('pause').disabled = true;
					document.getElementById('play').innerHTML = "►";
					clearInterval(p.loopint);
				});
				function ctrlClickChange(th) {
					ctrlClick=th.value;
				}
				function normalClickChange(th) {
					normalClick=th.value;
				}
				function altClickChange(th) {
					altClick=th.value;
				}
				var zoomClick=function(e) {
					var old=[];
					for (var i=0;i<p.data.length;i++) {
						old[i]=p.data[i]-0;
					}
					var getOldPixel=p.createGetPixel(old);
					var zoomXPos=Math.floor(e.layerX/20)+(p.mouseX-10),
						zoomYPos=Math.floor(e.layerY/20)+(p.mouseY-10),
						active;
					if (e.ctrlKey) active=ctrlClick;
					else if(e.altKey) active=altClick;
					else active=normalClick;
					if (p.makeConfirmColor(zoomXPos,zoomYPos,getOldPixel)(active)) {
						active="blank";
					}
					p.setPixel(zoomXPos,zoomYPos,active);
					p.apply();
					p.zoom({
						layerX:p.mouseX,
						layerY:p.mouseY,
					});
				};
				document.getElementById('zoom').addEventListener('click',zoomClick);
				document.getElementById('zoom').addEventListener('drag',zoomClick);
			}
		</script>
	</body>
</html>